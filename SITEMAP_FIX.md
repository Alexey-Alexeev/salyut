# Решение проблемы с sitemap.xml

## Проблема

При статическом экспорте Next.js (`output: 'export'`) происходил конфликт:
- В `public/sitemap.xml` находится детальный sitemap с video и image разметкой
- Next.js 13+ автоматически генерирует свой упрощенный `sitemap.xml` при сборке
- Автогенерированный sitemap **перезаписывал** детальный файл в директории `out/`

Результат: на продакшене (https://salutgrad.ru/sitemap.xml) был доступен упрощенный sitemap без важных метаданных для SEO.

## Решение

Реализованы следующие изменения:

### 1. Создан скрипт копирования
**Файл:** `scripts/copy-sitemap.js`

Скрипт автоматически копирует детальный sitemap из `public/sitemap.xml` в `out/sitemap.xml` после сборки, перезаписывая автогенерированную версию.

### 2. Обновлен build-процесс
**Файл:** `package.json`

```json
"build": "next build && node scripts/copy-sitemap.js"
```

Теперь после каждой сборки автоматически запускается копирование правильного sitemap.

### 3. Создан app/sitemap.ts
**Файл:** `app/sitemap.ts`

Возвращает пустой массив, чтобы минимизировать размер автогенерированного sitemap (который все равно будет перезаписан).

## Использование

### Обычная сборка
```bash
npm run build
```
Скрипт копирования запустится автоматически после сборки.

### Ручное копирование (если нужно)
```bash
npm run copy-sitemap
```

## Деплой

После деплоя новой сборки проверьте:
1. https://salutgrad.ru/sitemap.xml - должен содержать полную разметку с video и image тегами
2. Файл должен содержать ~56 KB данных
3. Должны присутствовать namespaces: `xmlns:image`, `xmlns:video`, `xmlns:mobile`, `xmlns:xhtml`

## Проверка локально

```bash
# Сборка
npm run build

# Проверка содержимого
head -20 out/sitemap.xml

# Должны увидеть:
# - xmlns:image="http://www.google.com/schemas/sitemap-image/1.1"
# - xmlns:video="http://www.google.com/schemas/sitemap-video/1.1"
# - Комментарии на русском языке
# - Детальные метаданные для каждой страницы
```

## Важно

- **Не удаляйте** `public/sitemap.xml` - это источник правильного sitemap
- **Не редактируйте** `out/sitemap.xml` вручную - он перезаписывается при каждой сборке
- Все изменения sitemap делайте в `public/sitemap.xml`
- После обновления `public/sitemap.xml` пересоберите проект: `npm run build`

## Преимущества решения

✅ Сохранены все SEO-метаданные (video, image tags)  
✅ Автоматизация - не требуется ручное копирование  
✅ Совместимость со статическим экспортом  
✅ Простота поддержки - правка в одном месте  

## Альтернативные решения (не использованы)

1. **Динамическая генерация sitemap.ts** - сложно поддерживать video/image теги программно
2. **Переименование файла** - нарушит стандартные пути (/sitemap.xml)
3. **Отключение статического экспорта** - противоречит требованию проекта

