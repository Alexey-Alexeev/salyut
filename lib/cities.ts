// Словарь транслитерации
const translitMap: { [key: string]: string } = {
    'а': 'a', 'б': 'b', 'в': 'v', 'г': 'g', 'д': 'd', 'е': 'e', 'ё': 'e', 'ж': 'zh', 'з': 'z',
    'и': 'i', 'й': 'y', 'к': 'k', 'л': 'l', 'м': 'm', 'н': 'n', 'о': 'o', 'п': 'p', 'р': 'r',
    'с': 's', 'т': 't', 'у': 'u', 'ф': 'f', 'х': 'h', 'ц': 'ts', 'ч': 'ch', 'ш': 'sh', 'щ': 'sch',
    'ъ': '', 'ы': 'y', 'ь': '', 'э': 'e', 'ю': 'yu', 'я': 'ya',
    ' ': '-', '-': '-'
};

// Функция для транслитерации (кириллица -> латиница)
export function transliterate(text: string): string {
    return text.toLowerCase().split('').map(char => translitMap[char] || char).join('');
}

// Функция для нормализации названия города (приведение к правильному регистру)
export function normalizeCityName(city: string): string {
    // Приводим к правильному регистру: первая буква заглавная, остальные строчные
    // Работает как с латиницей, так и с кириллицей
    if (city.length === 0) return city;

    // Для кириллицы используем специальную логику
    const firstChar = city.charAt(0);
    const rest = city.slice(1);

    // Преобразуем первую букву в заглавную
    const firstCharUpper = firstChar.toUpperCase();
    // Преобразуем остальные буквы в строчные
    const restLower = rest.toLowerCase();

    return firstCharUpper + restLower;
}

// Функция для поиска города по транслиту
export function findCityByTranslit(translit: string): string | null {
    for (const city of moscowRegionCities) {
        if (transliterate(city) === translit.toLowerCase()) {
            return city;
        }
    }
    return null;
}

// Функция для проверки, является ли город городом Московской области
export function isMoscowRegionCity(city: string): boolean {
    const normalizedCity = normalizeCityName(city);
    return moscowRegionCities.includes(normalizedCity);
}

// Функция для правильного склонения названий городов
export function getCityInPrepositionalCase(city: string): string {
    // Словарь для городов с особым склонением
    const specialCases: { [key: string]: string } = {
        'Москва': 'Москве',
        'Балашиха': 'Балашихе',
        'Подольск': 'Подольске',
        'Химки': 'Химках',
        'Мытищи': 'Мытищах',
        'Королёв': 'Королёве',
        'Люберцы': 'Люберцах',
        'Красногорск': 'Красногорске',
        'Электросталь': 'Электростали',
        'Коломна': 'Коломне',
        'Одинцово': 'Одинцове',
        'Домодедово': 'Домодедове',
        'Щёлково': 'Щёлкове',
        'Серпухов': 'Серпухове',
        'Раменское': 'Раменском',
        'Орехово-Зуево': 'Орехово-Зуеве',
        'Долгопрудный': 'Долгопрудном',
        'Пушкино': 'Пушкине',
        'Реутов': 'Реутове',
        'Жуковский': 'Жуковском',
        'Ногинск': 'Ногинске',
        'Сергиев Посад': 'Сергиевом Посаде',
        'Воскресенск': 'Воскресенске',
        'Лобня': 'Лобне',
        'Ивантеевка': 'Ивантеевке',
        'Клин': 'Клину',
        'Видное': 'Видном',
        'Дубна': 'Дубне',
        'Егорьевск': 'Егорьевске',
        'Чехов': 'Чехове',
        'Дмитров': 'Дмитрове',
        'Наро-Фоминск': 'Наро-Фоминске',
        'Ступино': 'Ступине',
        'Павловский Посад': 'Павловском Посаде',
        'Лыткарино': 'Лыткарине',
        'Фрязино': 'Фрязине',
        'Дзержинский': 'Дзержинском',
        'Котельники': 'Котельниках',
        'Солнечногорск': 'Солнечногорске',
        'Кашира': 'Кашире',
        'Краснознаменск': 'Краснознаменске',
        'Протвино': 'Протвине',
        'Истра': 'Истре',
        'Апрелевка': 'Апрелевке',
        'Шатура': 'Шатуре',
        'Дедовск': 'Дедовске',
        'Луховицы': 'Луховицах',
        'Можайск': 'Можайске',
        'Ликино-Дулёво': 'Ликино-Дулёве',
        'Красноармейск': 'Красноармейске',
        'Лосино-Петровский': 'Лосино-Петровском',
        'Озёры': 'Озёрах',
        'Звенигород': 'Звенигороде',
        'Старая Купавна': 'Старой Купавне',
        'Зарайск': 'Зарайске',
        'Электрогорск': 'Электрогорске',
        'Бронницы': 'Бронницах',
        'Хотьково': 'Хотькове',
        'Черноголовка': 'Черноголовке',
        'Электроугли': 'Электроуглях',
        'Пущино': 'Пущине',
        'Куровское': 'Куровском',
        'Кубинка': 'Кубинке',
        'Рошаль': 'Рошале',
        'Волоколамск': 'Волоколамске',
        'Белоозёрский': 'Белоозёрском',
        'Голицыно': 'Голицыне',
        'Яхрома': 'Яхроме',
        'Пересвет': 'Пересвете',
        'Краснозаводск': 'Краснозаводске',
        'Талдом': 'Талдоме',
        'Руза': 'Рузе',
        'Дрезна': 'Дрезне',
        'Высоковск': 'Высоковске',
        'Верея': 'Верее',
        'Серебряные Пруды': 'Серебряных Прудах'
    };

    // Если есть специальное склонение, используем его
    if (specialCases[city]) {
        return specialCases[city];
    }

    // Общие правила склонения
    if (city.endsWith('а') || city.endsWith('я')) {
        return city.slice(0, -1) + 'е';
    }
    if (city.endsWith('о') || city.endsWith('е')) {
        return city.slice(0, -1) + 'е';
    }
    if (city.endsWith('ск') || city.endsWith('цк')) {
        return city + 'е';
    }
    if (city.endsWith('цы') || city.endsWith('цы')) {
        return city.slice(0, -1) + 'ах';
    }

    // По умолчанию добавляем "е"
    return city + 'е';
}

// Список городов Московской области для SEO оптимизации
export const moscowRegionCities = [
    'Москва',
    'Балашиха',
    'Подольск',
    'Химки',
    'Мытищи',
    'Королёв',
    'Люберцы',
    'Красногорск',
    'Электросталь',
    'Коломна',
    'Одинцово',
    'Домодедово',
    'Щёлково',
    'Серпухов',
    'Раменское',
    'Орехово-Зуево',
    'Долгопрудный',
    'Пушкино',
    'Реутов',
    'Жуковский',
    'Ногинск',
    'Сергиев Посад',
    'Воскресенск',
    'Лобня',
    'Ивантеевка',
    'Клин',
    'Видное',
    'Дубна',
    'Егорьевск',
    'Чехов',
    'Дмитров',
    'Наро-Фоминск',
    'Ступино',
    'Павловский Посад',
    'Лыткарино',
    'Фрязино',
    'Дзержинский',
    'Котельники',
    'Солнечногорск',
    'Кашира',
    'Краснознаменск',
    'Протвино',
    'Истра',
    'Апрелевка',
    'Шатура',
    'Дедовск',
    'Луховицы',
    'Можайск',
    'Ликино-Дулёво',
    'Красноармейск',
    'Лосино-Петровский',
    'Озёры',
    'Звенигород',
    'Старая Купавна',
    'Зарайск',
    'Электрогорск',
    'Бронницы',
    'Хотьково',
    'Черноголовка',
    'Электроугли',
    'Пущино',
    'Куровское',
    'Кубинка',
    'Рошаль',
    'Волоколамск',
    'Белоозёрский',
    'Голицыно',
    'Яхрома',
    'Пересвет',
    'Краснозаводск',
    'Талдом',
    'Руза',
    'Дрезна',
    'Высоковск',
    'Верея',
    'Серебряные Пруды'
];

// Функция для генерации SEO мета-тегов для конкретного города
export function generateCitySEO(city: string) {
    const cityInPrepositionalCase = getCityInPrepositionalCase(city);

    return {
        title: `Купить салюты в ${cityInPrepositionalCase} | Фейерверки с доставкой | СалютГрад`,
        description: `Купить салюты и фейерверки в ${cityInPrepositionalCase} с доставкой. Профессиональный запуск салютов в ${cityInPrepositionalCase}. Качественная пиротехника для праздников. Быстрая доставка по ${city} и МО.`,
        keywords: `купить салюты в ${cityInPrepositionalCase}, фейерверки ${cityInPrepositionalCase}, салюты ${cityInPrepositionalCase} доставка, пиротехника ${cityInPrepositionalCase}, петарды ${cityInPrepositionalCase}, ракеты ${cityInPrepositionalCase}, фонтаны ${cityInPrepositionalCase}, запуск салютов ${cityInPrepositionalCase}, профессиональный салют ${cityInPrepositionalCase}`,
        openGraph: {
            title: `Купить салюты в ${cityInPrepositionalCase} | СалютГрад`,
            description: `Купить салюты и фейерверки в ${cityInPrepositionalCase} с доставкой. Профессиональный запуск салютов в ${cityInPrepositionalCase}. Качественная пиротехника для праздников.`,
            url: `https://салютград.рф?city=${encodeURIComponent(city)}`,
        }
    };
}

// Функция для генерации структурированных данных для города
export function generateCityStructuredData(city: string) {
    const cityInPrepositionalCase = getCityInPrepositionalCase(city);

    return {
        "@context": "https://schema.org",
        "@type": ["LocalBusiness", "Store"],
        "name": `СалютГрад - Фейерверки в ${cityInPrepositionalCase}`,
        "description": `Купить салюты и фейерверки в ${cityInPrepositionalCase} с доставкой. Профессиональный запуск салютов в ${cityInPrepositionalCase}.`,
        "url": `https://салютград.рф?city=${encodeURIComponent(city)}`,
        "telephone": "+7 (977) 360-20-08",
        "address": {
            "@type": "PostalAddress",
            "addressLocality": city,
            "addressRegion": "Московская область",
            "addressCountry": "RU"
        },
        "areaServed": [city, "Московская область"],
        "hasOfferCatalog": {
            "@type": "OfferCatalog",
            "name": `Каталог фейерверков и салютов в ${cityInPrepositionalCase}`,
            "itemListElement": [
                {
                    "@type": "Offer",
                    "itemOffered": {
                        "@type": "Product",
                        "name": `Фейерверки в ${cityInPrepositionalCase}`,
                        "description": `Качественные фейерверки и салюты с доставкой в ${cityInPrepositionalCase}`
                    }
                }
            ]
        }
    };
}

