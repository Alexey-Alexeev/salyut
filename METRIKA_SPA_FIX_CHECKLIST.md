# –ß–µ–∫-–ª–∏—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è SPA

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞
–Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞ –Ω–µ –ø–æ–ª—É—á–∞–ª–∞ –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞—Ö —Å—Ç—Ä–∞–Ω–∏—Ü, –∏–∑-–∑–∞ —á–µ–≥–æ:
- –ù–µ —Ä–∞–±–æ—Ç–∞–ª –í–µ–±–≤–∏–∑–æ—Ä
- –ù–µ —Å–æ–±–∏—Ä–∞–ª–∏—Å—å –≤–∏–∑–∏—Ç—ã
- –ù–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∞—Å—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º

### –ü—Ä–∏—á–∏–Ω–∞
–•–æ—Ç—è –ø–∞—Ä–∞–º–µ—Ç—Ä `defer: true` –±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –º–µ—Ç–æ–¥ `hit` –æ—Ç–ø—Ä–∞–≤–ª—è–ª—Å—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–ª–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö.

### –†–µ—à–µ–Ω–∏–µ
–ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü:

1. **–£–ø—Ä–æ—â–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** - –Ω–∞–¥–µ–∂–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å—á–µ—Ç—á–∏–∫–∞
2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–µ—Ä–≤–æ–≥–æ hit** - –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
3. **–£–ª—É—á—à–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏ SPA-–ø–µ—Ä–µ—Ö–æ–¥–∞—Ö** - —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º referer
4. **–î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º

## üìã –î–µ–π—Å—Ç–≤–∏—è –¥–ª—è –¥–µ–ø–ª–æ—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ª–æ–∫–∞–ª—å–Ω–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
npm run dev

# –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000
# –í –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏: [Metrika DEV] Page view: ...
```

### 2. –°–±–æ—Ä–∫–∞ –∏ –¥–µ–ø–ª–æ–π

```bash
# –°–æ–±–µ—Ä–∏—Ç–µ production –≤–µ—Ä—Å–∏—é
npm run build

# –î–µ–ø–ª–æ–π –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥ (—Å–æ–≥–ª–∞—Å–Ω–æ –≤–∞—à–µ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏)
npm run deploy
# –∏–ª–∏
npm run export && [–∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥]
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ production (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

#### –°—Ä–∞–∑—É –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç** https://salutgrad.ru

2. **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞** (F12 ‚Üí Console)

3. **–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É** (Ctrl+R) –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
   ```
   ‚úÖ –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
   [Metrika] Script loaded
   [Metrika] Counter ready after XXX ms
   [Metrika] Hit sent: {...}
   ```

4. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –¥—Ä—É–≥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –∫–∞—Ç–∞–ª–æ–≥):
   ```
   ‚úÖ –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
   [Metrika] URL changed: / -> /catalog
   [Metrika] Hit sent: {...}
   ```

5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network** (F12 ‚Üí Network):
   - –§–∏–ª—å—Ç—Ä: `mc.yandex.ru`
   - ‚úÖ –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ `https://mc.yandex.ru/watch/...`

#### –ß–µ—Ä–µ–∑ 1-2 —á–∞—Å–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:

6. **–ó–∞–π–¥–∏—Ç–µ –≤ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫—É**: https://metrika.yandex.ru/

7. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã —Å—Ç—Ä–∞–Ω–∏—Ü**:
   - –û—Ç—á–µ—Ç—ã ‚Üí –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ—Ç—á–µ—Ç—ã ‚Üí –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å ‚Üí –ü—Ä–æ—Å–º–æ—Ç—Ä—ã
   - ‚úÖ –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –Ω–æ–≤—ã–µ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã

8. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∏–∑–∏—Ç—ã**:
   - –û—Ç—á–µ—Ç—ã ‚Üí –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ—Ç—á–µ—Ç—ã ‚Üí –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å ‚Üí –°–≤–æ–¥–∫–∞
   - ‚úÖ –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –Ω–æ–≤—ã–µ –≤–∏–∑–∏—Ç—ã

#### –ß–µ—Ä–µ–∑ 2-3 —á–∞—Å–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:

9. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –í–µ–±–≤–∏–∑–æ—Ä**:
   - –í–µ–±–≤–∏–∑–æ—Ä (–≤ –ª–µ–≤–æ–º –º–µ–Ω—é)
   - ‚úÖ –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å–∏ —Å–µ–∞–Ω—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üö® –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### Hit –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è (–Ω–µ—Ç –ª–æ–≥–æ–≤ –≤ –∫–æ–Ω—Å–æ–ª–∏)

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ hostname**:
   - –°—á–µ—Ç—á–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ `salutgrad.ru`
   - –ù–∞ –¥—Ä—É–≥–∏—Ö –¥–æ–º–µ–Ω–∞—Ö/localhost –±—É–¥—É—Ç —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏ DEV

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–∏ —Ä–µ–∫–ª–∞–º—ã**:
   - –û—Ç–∫–ª—é—á–∏—Ç–µ AdBlock –∏ –ø–æ–¥–æ–±–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
   - –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤ —Ä–µ–∂–∏–º–µ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ

3. **–û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞**:
   - Ctrl+Shift+R (–∂–µ—Å—Ç–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)

### –õ–æ–≥–∏ –µ—Å—Ç—å, –Ω–æ –¥–∞–Ω–Ω—ã—Ö –≤ –ú–µ—Ç—Ä–∏–∫–µ –Ω–µ—Ç

1. **–ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 —á–∞—Å–∞** - –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network**:
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ `mc.yandex.ru`
   - –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è - –ø—Ä–æ–±–ª–µ–º–∞ —Å –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä–æ–º/–ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º

3. **–°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ú–µ—Ç—Ä–∏–∫–∏**:
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∏–º —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –ª–æ–≥–æ–≤ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏
   - –£–∫–∞–∂–∏—Ç–µ, —á—Ç–æ hit –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ –∏—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

### –í–µ–±–≤–∏–∑–æ—Ä –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ—Å—Ç—å –≤–∏–∑–∏—Ç—ã** - –±–µ–∑ –≤–∏–∑–∏—Ç–æ–≤ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –í–µ–±–≤–∏–∑–æ—Ä–∞**:
   - –ú–µ—Ç—Ä–∏–∫–∞ ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –í–µ–±–≤–∏–∑–æ—Ä
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∫–ª—é—á–µ–Ω

3. **–£—á–∏—Ç—ã–≤–∞–π—Ç–µ —Å—ç–º–ø–ª–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –Ω–µ –≤—Å–µ –≤–∏–∑–∏—Ç—ã

## üìù –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- ‚úÖ `components/yandex-metrika.tsx` - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (–ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω)
- ‚úÖ `lib/metrika.ts` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `sendMetrikaHit()`
- ‚úÖ `docs/yandex-metrika-spa-setup.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ `METRIKA_SPA_FIX_CHECKLIST.md` - —ç—Ç–æ—Ç —á–µ–∫-–ª–∏—Å—Ç

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–¥–∞ –∏ troubleshooting:
- `docs/yandex-metrika-spa-setup.md`

## ‚úâÔ∏è –°–≤—è–∑—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ú–µ—Ç—Ä–∏–∫–∏

–ï—Å–ª–∏ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –¥–∞–Ω–Ω—ã–µ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è:

1. –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã:
   - –õ–æ–≥–æ–≤ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
   - Network –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ mc.yandex.ru
   
2. –ù–∞–ø–∏—à–∏—Ç–µ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É:
   ```
   –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!
   
   –Ø –≤—ã–ø–æ–ª–Ω–∏–ª –≤—Å–µ –ø—É–Ω–∫—Ç—ã –∏–∑ –≤–∞—à–µ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è SPA-—Å–∞–π—Ç–æ–≤:
   1. ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä defer: true —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
   2. ‚úÖ –ú–µ—Ç–æ–¥ hit –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   3. ‚úÖ –ú–µ—Ç–æ–¥ hit –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ
   
   –ü—Ä–∏–∫–ª–∞–¥—ã–≤–∞—é —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –ª–æ–≥–æ–≤ –∏ –∑–∞–ø—Ä–æ—Å–æ–≤.
   –ü—Ä–æ—à—É –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ª–∏ —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ.
   ```

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è –∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:

‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä—ã —Å—Ç—Ä–∞–Ω–∏—Ü –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚úÖ –í–∏–∑–∏—Ç—ã —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º referer
‚úÖ –í–µ–±–≤–∏–∑–æ—Ä –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–µ–∞–Ω—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚úÖ –í—Å–µ –æ—Ç—á–µ—Ç—ã –≤ –ú–µ—Ç—Ä–∏–∫–µ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –¥–∞–Ω–Ω—ã–º–∏
‚úÖ –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 2 –¥–µ–∫–∞–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è**: 1.0
**–°—Ç–∞—Ç—É—Å**: –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é ‚úÖ

